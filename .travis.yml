env:
  global:
   - secure: Qu5dqjC/SBegoTLZdhCwqMznPULxcR0/NMNmFMPckvoaoxwbOQqLO6TuiuR88KeHHAJ0ZXeT8aUyQVmhA0KT6OF6v4TcdSfkO/1z+fx+Dc+Kybm3ZQ9AJ+t0ANGcOtUGke51QYXJiTJPUMCDCQ5usfgf4AILXfDX9NoQDYeP+j6bI4vB5er5vf6M3c0A9FfpE48letm2Ux3Jb0Vr1VIivbT4pnfdifDBJs7KrK+5KxA/FSbigZjUrTqorNys/puWL3mCBt6Y3kImkJUTlwd0pEXTammLwEnckiSeme6zUfuCyVQ5BS37DJB2Puiq9rRPR7lauk4lCseFTns9Gp/1dRRy0VLT7HJIG13cDaXokHaRwhZLvLrfahNAuETIyx5VlmnnAuFbrhcKAmGPluaWs18VPrSq1K1jWloMaxcSOUOoGuJ91r5sumqL3CkrOauO3MnGwNxPlZ5b9HK4kjhXZDmzupCzeirrqAh3DJIeZ3EiXjsXY6MehRX/ZiWrBouiTE/tL/3ZrpimbhM1mQdA/dGoCNLdcFmn94LXdXkzYdfG8oztUdr+8RxJqzsfby+duS/7IChBfcVy7H8n2ATyT5hEZZsd46cgonG/G3EoezSKZUYaO53f1iuIBJTwqXcnhufuUTxxNUmKWwJP67/SEusRXEKtCB6OIEnXkaFu0ZA=
   - secure: ra7yUirYwcjH/0wQDs2cj4XAPNuvwyDfWe5fdqvRZTtme6jVYj8CGk+Khc07WOCdxQnhKeeUvKZtQwQdWNXsSAKMVDXr1LyvZNWgosX0OgZxQY08Iz+WK6fXEQOHZ8FdJNjQjsyCK8QbCQtbCDUS4GuvOCyqU7lLs/n8XT/+8qpbCdzwArbm9QyiwZe5ujlK+o9c3aCi2Mb7aImx7KweY+QnlI53QVw0M4QXyUJtVTEhRTN66LdrExMqSgLZGlZZT2oApyerLCKqHXWW3nWMRDXROedlhIZN6eBhdrlD8CyjLF2ZMvNkGUddupr/bB/MWunvo60cLjZwY9JETMnwMC8Q0Ff0kdrlz8ms1v4yn/kvq3AkfwXC2CtfxjIfH1pcCOAFtFqKqDPYN+4vZvJjZhVFjpawvp5V0Vh8vkuivOo3HuU7p3Ad/3n/2HTOnv8atiOuWHaUsEEO7buRDGdkUHVBW6a+A3Tbcn6uCH47RPBRZRf1NPrGofOzKbOZJFRvW+kQVedb4NO2gFAvGYs8+4KwaKtT4mgW3KVtPSuCSH03FbkIjIKJ6/cwO86aDiOZGsFJMe3ir4X31BjjnXXJzCHa9jgq8a7amLhJJHjOrJcsAA4YL9XT7BCaNBNh39S9IHFYcoV0zMGhQF7I45yUuhhejaPpVkgLTbTwOEa8Njk=
 
services:
- docker

addons:
  sonarcloud:
    organization: departement-loire-atlantique
    token:
      secure: M+8vAHlAT0EB4byV3wLQcWKiZF/JmolYEd7GDydRwAXBqWZsCNmWh80C0Nr2o4OhQpHrvSe3MROD4ZAH8gYAaWYZwaFm00NLLrjW1yb3rx0ExgeuSS5tzmjujSf61hbQaKw+3u2nDZMWaANfti4a5Cur9tFEcLXt2SAhNWV9jWxXb2cHrNdcT22qKigXrzJBWeAwvcKqCcKKGPoMfiMVcMqTb7caMRImIpleniRFQ/kjhOVrE10Qj/IyHgR34a8IBLBGvjJVNkCmYNMJ4IIOXjZl4QxJo68PvkXqToD7+bSZRp2GD1yaOFY4yr+Qu9L8ZlPgJ5D2VuPfYgUAGkBLt+p5SOP34a40H3OHTjxBaA4xCF3oswdO9w0zriNjgw+Fxn3XjGYWwpcrP69uZPDpgBAY9xTzFeZQA15HCqqKObe352FbXcYg4vuqKbGIcnUVobPXBicjGhgWzQMI/LWHb5aDRyOaUJL3UfPv0yKr55Re2VvqLg4zc52oNu6kuPT+dEWig9i5GEhQjTbLdMdZfGGk+++95PS9c39hp19cBYcjbcM6PdGYHWf/lKfi9qk7JZTXYoaso0eiS2Nm2gnYD9boPODSBlhWV+gQC0HyJjNKJ/79wYLqYRqXddHVqJiF5NdbuYZsH18Wilu1ssMshuMncTZ5c140GWHpsplKtYA=

before_script:
- echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
- docker pull julienbayle/jplatformbuild

script:
- docker run -v ${TRAVIS_BUILD_DIR}:/root/source --name buildimage -t julienbayle/jplatformbuild
- docker cp buildimage:/root/dist .
- export CODE_VERSION=`git describe`
- sonar-scanner -Dsonar.projectVersion=$CODE_VERSION

deploy:
  provider: releases
  api_key:
    secure: kxrGYY6A0RWHSXhjvWBXKVOhkSNVOAqW93e1/uCcuCe4J7v/SAcVDa3Rp46p050WD4txm6pyBCnvNVcseIQzZ6btwnf9+AfC5Y8C8J36JRL+B8n0i7b7Olm9BYciLuz8NflEgDV0yU2uJdj5vWIHcbp/1PeOMCiblDCoLPMJ9Tgr0yktX8vThzZZC71+ahADlJvCGcooixdyJqmMbqA9MRu131nZUd1Q7ggsW29z4n8NDLXOme5R3jPvqg+T57043mph9ZZNrAjirbo0zFGsi3DIL28WnloenFYeIdGtx+FbmBllPij0B9557i1uauFl+Q+eptqFRG9G3SQiUh2VIy7fRKE2Ney6a0bmOqix9uM8/nrurIOU6JdTELrKMWguHC8/V3gtmduKB8LWy+uGOCiKyV7p33DQH/UW98v+JPIzPXWQ5AMf12sU+M57Ybv7a4GKr7UDpHeFK/mdGQzGXmnfLUyFYXLYH5E1i4faC68f48AqOWMqBl/BPb1zRuE5W4htb8s9A3nZdQa9iABILvJwB68USqNBsxhAOKgcZijLxkGaVRY1DcETE3PzN7UnbFAFQN7+uyNUN0dRULTvoDjF/FREDzOdEJNk2pUBqSSNovnSgn2RCbq18HuewqfQkhRiExPALnym6vMExWT5qArdhJwVZYSHV1CX2W1f2mQ=
  file_glob: true
  file: "${TRAVIS_BUILD_DIR}/dist/*.zip"
  skip_cleanup: true
  on:
    tags: true
